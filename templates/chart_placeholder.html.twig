<div id="placeholder" style="width: {% if width is defined %}width{% else %}950px{% endif %}; height: 400px;"></div>
<p>
You can zoom into the chart by dragging, double clicking or using your scrollwheel. <br />
</p>

<script type="text/javascript">
var formatGW2Money = function(copper) {
    var string = "";

    var gold = Math.floor(copper / 10000);
    if (gold) {
        copper = copper % (gold * 10000);
        string += gold + "g ";
    }

    var silver = Math.floor(copper / 100);
    if (silver) {
        copper = copper % (silver * 100);
        if (silver) string += silver + "s ";
    }

    copper = Math.floor(copper);

    if (copper) string += copper + "c ";

    if (!string) {
        return copper + "c";
    } else {
        return string;
    }
};

$.ajax("{{ "/chart/" ~ item.dataId }}", {
    success: function(chartdata) {
        var chartdata   = $.parseJSON(chartdata);
        var placeholder = $("#placeholder");
        var plot;
        var options     = {
            grid: {
                hoverable: true,
            },
            tooltip:  true,
            tooltipOpts: {
                content:    "%s | %x | %y",
                stringFormat: {
                    yFormat: formatGW2Money
                },
                dateFormat: "%Y-%m-%d %H:%S"
            },
            series: {
                lines:  { show: true },
                points: { show: true }
            },
            xaxis: {
                mode:            "time",
                timeformat:      "%d-%b",
                twelveHourClock: false,
                zoomRange:       null,
                panRange:        null,
                minTickSize:     [1, "day"]
            },
            yaxis: {
                zoomRange:   false,
                panRange:    false,
                minTickSize: 1,
                tickFormatter: formatGW2Money
            },
            zoom: {
                // interactive: true
            },
            pan: {
                // interactive: true
            },
            selection: { mode: "x" }
        };
        var xaxis_default = null;

        placeholder.bind('plotzoom', function() {
            plot.pan({left: 0, top: 0});
        });

        var render = function(extraoptions) {
            var extraoptions  = extraoptions || {};
            var renderoptions = {};
            var first = chartdata[0]['data'][0][0];

            renderoptions.xaxis = {};
            // renderoptions.xaxis.zoomRange = [first, null];
            renderoptions.xaxis.panRange  = [first, null];

            plot = $.plot(placeholder, chartdata, $.extend(true, {}, options, renderoptions, extraoptions));

            // add zoom out button
            $('<div class="btn" style="right:20px; bottom:23px; position:absolute;">zoom out</div>').appendTo(placeholder).click(function (e) {
                e.preventDefault();
                plot.zoomOut();
            });

        }
        render();
    }
});
</script>
